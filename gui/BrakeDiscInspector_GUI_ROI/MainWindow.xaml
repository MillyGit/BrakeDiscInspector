<Window x:Class="BrakeDiscInspector_GUI_ROI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:BrakeDiscInspector_GUI_ROI"
        xmlns:workflow="clr-namespace:BrakeDiscInspector_GUI_ROI.Workflow"
        Title="Inspector — Masters &amp; ROI" Height="900" Width="1400"
        WindowStartupLocation="CenterScreen" Background="#0E0E10"
        UseLayoutRounding="True">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- Lado Izquierdo: Imagen + Canvas CON AdornerDecorator -->
        <Grid Grid.Column="0" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ⬇⬇⬇ ADORNER DECORATOR requerido para que el RoiAdorner funcione -->
            <AdornerDecorator Grid.Row="0">
                <Grid Background="#111">
                    <Grid>
                        <Image x:Name="ImgMain" Stretch="Uniform" Panel.ZIndex="0" />
                        <Image x:Name="HeatmapOverlay"
                               IsHitTestVisible="False"
                               Stretch="Fill"
                               HorizontalAlignment="Left"
                               VerticalAlignment="Top"
                               SnapsToDevicePixels="True"
                               Opacity="0.75"
                               Visibility="Collapsed"
                               Panel.ZIndex="1"/>
                        <Canvas x:Name="CanvasROI"
                                Background="Transparent"
                                IsHitTestVisible="True"
                                Panel.ZIndex="2"/>
                        <local:RoiOverlay x:Name="RoiOverlay"
                                          Visibility="Collapsed"
                                          IsHitTestVisible="False"
                                          Panel.ZIndex="3"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Stretch"/>
                    </Grid>
                </Grid>
            </AdornerDecorator>
            <!-- ⬆⬆⬆ -->

            <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,8,0,0">
                <Button Content="Cargar Imagen..." Margin="0,0,8,0" Click="BtnLoadImage_Click"/>
                <Button x:Name="BtnAnalyzeMaster" Content="Analizar Master" Margin="0,0,8,0" Click="BtnAnalyzeMaster_Click" IsEnabled="False"/>
                <Button x:Name="BtnAnalyzeROI" Content="Analizar ROI" Click="BtnAnalyzeROI_Click"/>
                <CheckBox x:Name="ChkUseLocalMatcher" Margin="16,0,0,0" Content="Usar matcher local" IsChecked="True"/>
            </StackPanel>
        </Grid>

        <!-- Lado Derecho: Wizard/Stepper + Logs -->
        <DockPanel Grid.Column="1" Margin="10">
            <GroupBox Header="Visibilidad ROI" DockPanel.Dock="Top" Margin="0,0,0,8">
                <StackPanel>
                    <CheckBox x:Name="ChkShowMaster1Pattern"
                              Content="Master 1"
                              IsEnabled="False"
                              IsChecked="False"
                              Checked="RoiVisibilityCheckChanged"
                              Unchecked="RoiVisibilityCheckChanged"/>
                    <CheckBox x:Name="ChkShowMaster1Inspection"
                              Content="Inspection Master 1"
                              IsEnabled="False"
                              IsChecked="False"
                              Margin="0,4,0,0"
                              Checked="RoiVisibilityCheckChanged"
                              Unchecked="RoiVisibilityCheckChanged"/>
                    <CheckBox x:Name="ChkShowMaster2Pattern"
                              Content="Master 2"
                              IsEnabled="False"
                              IsChecked="False"
                              Margin="0,4,0,0"
                              Checked="RoiVisibilityCheckChanged"
                              Unchecked="RoiVisibilityCheckChanged"/>
                    <CheckBox x:Name="ChkShowMaster2Inspection"
                              Content="Inspection Master 2"
                              IsEnabled="False"
                              IsChecked="False"
                              Margin="0,4,0,0"
                              Checked="RoiVisibilityCheckChanged"
                              Unchecked="RoiVisibilityCheckChanged"/>
                    <CheckBox x:Name="ChkShowInspectionRoi"
                              Content="Inspection ROI"
                              IsEnabled="False"
                              IsChecked="False"
                              Margin="0,4,0,0"
                              Checked="RoiVisibilityCheckChanged"
                              Unchecked="RoiVisibilityCheckChanged"/>
                </StackPanel>
            </GroupBox>
            <TabControl x:Name="Tabs" DockPanel.Dock="Top">
                <TabItem x:Name="TabMaster1" Header="1) Master 1">
                    <StackPanel Margin="10">
                        <TextBlock Text="Tipo:"/>
                        <ComboBox x:Name="ComboMasterRoiRole" Margin="0,4,0,8"/>
                        <TextBlock Text="Forma:"/>
                        <ComboBox x:Name="ComboMasterRoiShape" Margin="0,4,0,8">
                            <ComboBoxItem Content="Rectángulo"/>
                            <ComboBoxItem Content="Círculo"/>
                        </ComboBox>
                        <WrapPanel>
                            <Button x:Name="BtnSaveMaster" Content="Save Master 1" Click="BtnSaveMaster_Click" Margin="0,0,8,0"/>
                            <Button Content="Validar Master 1" Click="BtnValidateM1_Click"/>
                        </WrapPanel>
                        <Border Margin="0,8,0,0" Background="#11000000" Padding="8">
                            <TextBlock x:Name="TxtMasterHints" TextWrapping="Wrap"/>
                        </Border>
                    </StackPanel>
                </TabItem>

                <TabItem x:Name="TabMaster2" Header="2) Master 2" IsEnabled="False">
                    <StackPanel Margin="10">

                        <!-- NUEVO: igual que Master 1 -->
                        <TextBlock Text="Tipo:"/>
                        <!-- NUEVO -->
                        <ComboBox x:Name="ComboM2Role" Margin="0,4,0,8"/>
                        <!-- NUEVO -->

                        <TextBlock Text="Forma:"/>
                        <ComboBox x:Name="ComboM2Shape" Margin="0,4,0,8">
                            <ComboBoxItem Content="Rectángulo"/>
                            <ComboBoxItem Content="Círculo"/>
                        </ComboBox>

                        <WrapPanel>
                            <Button Content="Save Master 2" Click="BtnSaveMaster_Click" Margin="0,0,8,0"/>
                            <Button Content="Validar Master 2" Click="BtnValidateM2_Click"/>
                        </WrapPanel>

                        <TextBlock Text="Dibuja patrón y zona de búsqueda igual que en Master 1." Margin="0,8,0,0"/>
                    </StackPanel>
                </TabItem>

                <TabItem x:Name="TabInspection" Header="3) Inspección" IsEnabled="False">
                    <StackPanel Margin="10">
                        <TextBlock Text="Forma:"/>
                        <ComboBox x:Name="ComboInspShape" Margin="0,4,0,8">
                            <ComboBoxItem Content="Rectángulo"/>
                            <ComboBoxItem Content="Círculo"/>
                            <ComboBoxItem Content="Annulus"/>
                        </ComboBox>
                        <WrapPanel>
                            <Button Content="Save ROI Inspection" Click="BtnSaveMaster_Click" Margin="0,0,8,0"/>
                            <Button Content="Validar Inspección" Click="BtnValidateInsp_Click"/>
                        </WrapPanel>
                        <TextBlock Text="Tras 'Analizar Master', el ROI se recoloca al punto medio de M1 y M2." Margin="0,8,0,0"/>
                    </StackPanel>
                </TabItem>

                <TabItem x:Name="TabAnalyze" Header="4) Análisis" IsEnabled="False">
                    <StackPanel Margin="10">
                        <TextBlock Text="Feature (sin geom):"/>
                        <ComboBox x:Name="ComboFeature" Margin="0,4,0,8">
                            <ComboBoxItem Content="auto"/>
                            <ComboBoxItem Content="sift"/>
                            <ComboBoxItem Content="orb"/>
                            <ComboBoxItem Content="tm_rot"/>
                        </ComboBox>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="Thr:" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtThr" Width="60" Margin="6,0,16,0" Text="85"/>
                            <TextBlock Text="RotRange:" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtRot" Width="60" Margin="6,0,16,0" Text="10"/>
                            <TextBlock Text="ScaleMin:" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtSMin" Width="60" Margin="6,0,16,0" Text="0.95"/>
                            <TextBlock Text="ScaleMax:" VerticalAlignment="Center"/>
                            <TextBox x:Name="TxtSMax" Width="60" Margin="6,0,0,0" Text="1.05"/>
                        </StackPanel>

                        <WrapPanel>
                            <Button Content="Guardar Preset" Click="BtnSavePreset_Click" Margin="0,0,8,0"/>
                            <Button Content="Cargar Preset..." Click="BtnLoadPreset_Click" Margin="0,0,8,0"/>
                            <Button Content="Guardar Layout" Click="BtnSaveLayout_Click" Margin="0,0,8,0"/>
                            <Button Content="Cargar Layout" Click="BtnLoadLayout_Click"/>
                        </WrapPanel>
                    </StackPanel>
                </TabItem>

                <TabItem x:Name="TabWorkflow" Header="5) Dataset &amp; AI">
                    <workflow:WorkflowControl x:Name="WorkflowHost" />
                </TabItem>
            </TabControl>

            <!-- === Resultado de análisis (solo score) === -->
            <StackPanel Margin="0,8,0,0">
                <TextBlock x:Name="ResultLabel"
                           Text="Sin resultado"
                           FontSize="16"
                           FontWeight="Bold"
                           Foreground="#ddd"/>
            </StackPanel>

            <GroupBox Header="Log" Margin="0,8,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Height="300">
                    <TextBox x:Name="TrainLogText" TextWrapping="Wrap" IsReadOnly="True" AcceptsReturn="True" Background="#111" Foreground="#ddd"/>
                </ScrollViewer>
            </GroupBox>
        </DockPanel>
    </Grid>
</Window>
